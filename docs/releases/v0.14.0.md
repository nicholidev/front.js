# v0.14.0 Release Notes

This release includes some significant improvements to the way Remix apps are deployed to production. Specifically, this includes two major improvements to a production Remix app:

- No more dev-only dependencies
- No more dynamic requires

These are some pretty major changes to the underlying architecture of Remix that fixes support for several cloud providers and opens the door to deploying to many more.

## Upgrading Summary

To upgrade from Remix 0.13:

- Remove `@remix-run/cli` from your `dependencies` in `package.json` and replace it with `@remix-run/dev` in your `devDependencies`
- Use `createRequestHandler({ build: require("./build") })` in `server.js`
- Add a `postinstall` step to run `remix build`
- In dev mode, watch `build/assets.json` to know when to restart the server

As always, remember to use the starters as your guide. We currently have starter repos for:

- [Express](https://github.com/remix-run/starter-express)
- [Architect](https://github.com/remix-run/starter-architect)
- [Vercel](https://github.com/remix-run/starter-vercel)

## Background

Before Remix 0.14, we had both development and production dependencies in the same package: `@remix-run/core`. Having everything in one package helped us bootstrap the project quickly, but also became a burden over time. For example, as we added features to the Remix compiler, which is only needed in development, the overall size of the dependencies Remix needed in a production deployment grew. So we knew we needed to split out all of Remix's development dependencies into a separate package. In addition, some of our dev dependencies require binaries that we are not able to deploy to Architect, so separating them out into a separate dev-only package fixes production deploys on Architect.

Another issue with deploying Remix to production before this release is that it required you to deploy your `remix.config.js` file (and your `app` directory!) alongside your `build` directory. Remix would read the config and reconstruct the route hierarchy at runtime so that it knew about any dynamic routes you created using `config.routes`. It would also dynamically `require` all modules needed to run your app, which was a non-starter on hosts like Netlify (and, recently, Vercel). So we knew we needed to get rid of all dynamic `require`s in production. You shouldn't have to deploy your source code, just the build artifacts.

So this release splits up our core dependency and completely alters the way we load modules and deploy to production.

No sweat, right? ðŸ˜…

The big winner is that your production deploys are going to be more streamlined (no dev dependencies) and we are laying the groundwork for being able to deploy Remix to more providers.

## Upgrading

Despite the significant changes on our side, upgrading your app from Remix 0.13 should be fairly straightforward.

First, remove `@remix-run/cli` from your `dependencies` in `package.json` and replace it with `@remix-run/dev` in your `devDependencies.

```sh
$ npm remove @remix-run/cli
$ npm add -D @remix-run/dev
```

Going forward, `@remix-run/dev` will contain everything you need to develop a Remix app. It should only ever be in `devDependencies` so it doesn't end up in your production environment. We even named it `dev` to help you remember :D

Next, we need to let the Remix server know about our app. In Remix 0.14, your entire app is compiled down to a single module in `build/index.js` with static `require` calls to load the rest of the app. This means you can load the entire app using `require("./build")` (or whatever your `config.serverBuildDirectory` is).

To upgrade, open up `server.js` and add the `build` key to your server's `createRequestHandler`:

```diff
  createRequestHandler({
+   build: require("./build"),
    getLoadContext() {
      // ...
    }
  })
```

This line requires the entire app and passes it to your server. Of course, this means you'll need to actually build the app before you can start the server, so you may want to add a `postinstall` hook to your `package.json` so that your app is ready to go after a fresh `npm install`:

```json
{
  "scripts": {
    "postinstall": "remix build"
  }
}
```

You'll probably also want to update your file watcher in development. We currently recommend watching `build/assets.json` to know when to restart your server.

In [the Express starter](https://github.com/remix-run/starter-express) we use PM2. The relevant portion of [the config](https://github.com/remix-run/starter-express/blob/master/pm2.config.js) looks like this:

```js
module.exports = {
  apps: [
    {
      script: "server.js",
      watch: ["build/assets.json"]
    }
  ]
}
```

Note: There are actually 2 builds going on (server and client), but the client build always takes longer since it has to bundle dependencies as well as your app code. So that's why we recommend watching `build/assets.json`. We are, however, working on improving our build times, so this recommendation may change soon.

And that should be it! Congrats on upgrading to Remix 0.14.

Enjoy your slimmed down production builds!